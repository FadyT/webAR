<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>AR Video Player</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    #ar-container {
      width: 100vw;
      height: 100vh;
    }

    #ar-video {
      display: none; /* Hide video until the target is detected */
    }
  </style>
</head>

<body>
  <!-- Video Element -->
  <video id="ar-video" src="video.mp4" loop muted></video>

  <!-- AR Container -->
  <div id="ar-container"></div>

  <!-- Load Scripts from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.1/dist/mindar-image-three.prod.js"></script>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <script>
    // Ensure scripts are loaded successfully
    window.addEventListener("load", () => {
      if (!window.THREE) {
        console.error("❌ Three.js failed to load!");
        return;
      } else {
        console.log("✅ Three.js loaded successfully!");
      }

      if (!window.MINDAR) {
        console.error("❌ MindAR failed to load!");
        return;
      } else {
        console.log("✅ MindAR loaded successfully!");
      }

      // Importing MindARThree from the MindAR package
      const { MindARThree } = window.MINDAR;

      // Initialize MindAR with the target image
      const mindarThree = new MindARThree({
        container: document.querySelector("#ar-container"),
        imageTargetSrc: "targets.mind",
      });

      const { renderer, scene, camera } = mindarThree;

      // Set up the video texture
      const video = document.querySelector("#ar-video");
      const videoTexture = new THREE.VideoTexture(video);

      // Create a PlaneGeometry to display the video
      const geometry = new THREE.PlaneGeometry(1, 0.75);
      const material = new THREE.MeshBasicMaterial({ map: videoTexture });
      const videoPlane = new THREE.Mesh(geometry, material);

      // Create an anchor for the target (index 0 for the first target in .mind file)
      const anchor = mindarThree.addAnchor(0);
      anchor.group.add(videoPlane);

      // Play/Pause the video when the target is found/lost
      anchor.onTargetFound = () => {
        video.play();
        console.log("🎯 Target Found: Playing Video");
      };

      anchor.onTargetLost = () => {
        video.pause();
        console.log("❌ Target Lost: Pausing Video");
      };

      // Start AR session
      mindarThree.start();

      // Animation loop to render the scene continuously
      renderer.setAnimationLoop(() => {
        renderer.render(scene, camera);
      });
    });
  </script>

</body>

</html>
